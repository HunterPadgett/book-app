---
import Layout from "../layouts/Layout.astro";
---

<Layout title="My Books">
 <h2 class="container mx-auto flex items-center justify-center text-3xl">
  Add new book
 </h2>
 <div class="container mx-auto flex items-center justify-center">
  <input
   type="text"
   placeholder="Book title"
   class="input-bordered input-secondary input w-full max-w-xs"
  />
  <button class="btn-secondary btn-active btn max-w-xs" id="add-book-btn"
   >Add</button
  >
 </div>
 <div
  class="grid grid-cols-1 gap-6 md:grid-cols-2 shadow"
  id="books-read"
 >

 </div>
</Layout>

<script>
 async function addBook() {
  let title = document.querySelector("input");
  const bookSection = document.querySelector("#books-read");
  const convertedTitle = title.value
   .split(" ")
   .join("+")
   .toLocaleLowerCase()
   .trim();

  let coverUrl = ``;
  console.log(convertedTitle);

  try {
   // first fetch for book title
   const response = await fetch(
    `https://openlibrary.org/search.json?q=${convertedTitle}&limit=10`
   );
   const data = await response.json();
   console.log(data);
   const bookTitle = data.docs[0].title;
   const isbn = data.docs[0].isbn[0];
   //  second fetch for ISBN
   const postsResponse = await fetch(
    `https://openlibrary.org/isbn/${isbn}.json`
   );
   const isbnData = await postsResponse.json();
   console.log(isbnData);
   if (isbnData.covers[0]) {
    coverUrl = `https://covers.openlibrary.org/b/id/${isbnData.covers[0]}-M.jpg`;
    console.log(coverUrl);
   } else {
    coverUrl = "book cover not available";
   }

   const html = `
    <div class="card card-side bg-accent-content shadow">
   <figure>
    <img class="max-w-xs" src="${coverUrl}" alt="Movie" />
   </figure>
   <div class="card-body">
    <h2 class="card-title">${bookTitle}</h2>
    <p>Click the button to watch on Jetflix app.</p>
   </div>
  </div>
   `;

   bookSection.insertAdjacentHTML("beforeend", html);
   title.value = "";
   //  error handling
  } catch (error) {
   console.error(error);
  }
 }

 document.querySelector("#add-book-btn").addEventListener("click", addBook);
</script>
